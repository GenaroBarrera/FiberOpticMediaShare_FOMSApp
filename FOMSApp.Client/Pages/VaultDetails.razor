@page "/vault/{Id:int}"
@using FOMSApp.Shared.Models
@using System.Text.Json
@using NetTopologySuite.IO.Converters
@inject HttpClient Http

<PageTitle>Vault Details</PageTitle>

@if (vault == null)
{
    <p><em>Loading details...</em></p>
}
else
{
    <div class="card">
        <div class="card-header">
            <h2>@vault.Name</h2>
        </div>
        <div class="card-body">
            <p><strong>Status:</strong> @vault.Status</p>
            <p><strong>Location ID:</strong> @vault.Id</p>
            <hr />
            
            <h4>Photos</h4>
            <p class="text-muted">No photos uploaded yet.</p>

            <br />
            <a href="/" class="btn btn-secondary">Back to Map</a>
        </div>
    </div>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private Vault? vault;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Configure the JSON options again (Case Insensitive + GeoJSON)
            var options = new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            };
            options.Converters.Add(new GeoJsonConverterFactory());

            // Fetch the single vault
            vault = await Http.GetFromJsonAsync<Vault>($"api/vaults/{Id}", options);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching vault details: {ex.Message}");
        }
    }
}